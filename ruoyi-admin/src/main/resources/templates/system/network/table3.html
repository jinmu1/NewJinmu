<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <script th:src="@{/js/jquery.min.js}"></script>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
    <script th:src="@{/js/plugins/bootstrap/bootstrap-table.js}"></script>
    <script th:src="@{/js/plugins/bootstrap/bootstrap-table-export.js}"></script>
    <script th:src="@{/js/plugins/bootstrap/jquery.base64.js}"></script>
    <script th:src="@{/js/plugins/bootstrap/tableExport.js}"></script>

</head>


<body>
    <div>
        <input type="file" class="form-control btn-block" placeholder="" readonly id="input_file" style="filter:alpha(opacity=0);opacity:0;width: 0;height: 0;">
    </div>

    <div>

    </div>
    <div id="reportTableDiv" class="span10" style="width:90%">
        <div style="text-align: center;">
            <h2>
                出入库数据</h2>
        </div>

        <table id="reportTable">
        </table>
    </div>

    <script type="text/javascript">
        var ctx = "http://edu.glc360.com";
        //    var ctx = "http://localhost:8084";
        $("button#open_file").click(function() {
            OpenFile();
        });
        var file_addr = "";

        function OpenFile() {
            var tn = 0;
            $("input#input_file").change(function() {
                if (tn == 0) {
                    console.log(this.files[0]);
                    file_addr = this.files[0].path; //Get file absolute path
                    console.log(file_addr);
                    onloadData(file_addr);
                    this.files[0].path = "";
                }
                tn += 1;
            });
            $("input#input_file").trigger("click");
        }

        function onloadData() {
            $.post(ctx + "/system/needorder/list1", {},
                function(result) {
                    var data = result;
                    var main = data;
                    $('#reportTable').bootstrapTable({
                        method: 'get',
                        cache: false,
                        height: 400,
                        striped: true,
                        pagination: true,
                        pageSize: 20,
                        pageNumber: 1,
                        pageList: [10, 20, 50, 100, 200, 500],
                        search: true,
                        showColumns: true,
                        showRefresh: true,
                        showExport: true,
                        exportTypes: ['excel'],
                        clickToSelect: true,
                        columns: [{
                            field: "date",
                            title: "订单日期",
                            align: "center",
                            valign: "middle",
                            sortable: "true"
                        }, {
                            field: "orderCode",
                            title: "订单编码",
                            align: "center",
                            valign: "middle",
                            sortable: "true"
                        }, {
                            field: "customer",
                            title: "客户编码",
                            align: "center",
                            valign: "middle",
                            sortable: "true"
                        }, {
                            field: "customerName",
                            title: "客户名称",
                            align: "center",
                            valign: "middle",
                            sortable: "true"
                        }, {
                            field: "goodsCode",
                            title: "物料编码",
                            align: "center",
                            valign: "middle",
                            sortable: "true"
                        }, {
                            field: "goodsNum",
                            title: "物料量",
                            align: "center",
                            valign: "middle",
                            sortable: "true"
                        }, {
                            field: "volume",
                            title: "体积",
                            align: "center",
                            valign: "middle",
                            sortable: "true"
                        }, {
                            field: "weight",
                            title: "重量",
                            align: "center",
                            valign: "middle",
                            sortable: "true"
                        }],
                        data: main,
                        onPageChange: function(size, number) {
                            console.log("页面发生了变化")
                                //$("#pageSizeInput").val(size);
                                //$("#pageNumberInput").val(number);

                            //var form = $('#tableForm');
                            //form.action= '${base}/showReport';
                            //form.submit();
                        },
                        //onSort: function (name, order) {
                        // }         ,
                        //fo              rmatShowingRows: function (pageFrom, pageTo, totalRows) {
                        //	r       eturn '';
                        // } ,
                        //fo     rmatRecordsPerPage: function () {
                        //	return '';
                        //      },
                        //                      formatNoMatches: function(){
                        //                           	return '�޷�������ļ�¼';
                        //                     }
                    });
                })

        }
        onloadData();

        function int2str(num) {
            num = parseInt(num);
            let numberStr = num.toString()
            let str = numberStr.split('').reverse()
            for (let i = 0; i < str.length; i++) {
                if ((i + 1) % 4 === 0) {
                    str.splice(i, 0, ',')
                }
            }
            str.reverse()
            let handleResult = ''
            for (let j = 0; j < str.length; j++) {
                handleResult += str[j]
            }
            return handleResult
        }

        function formatNum(strNum) {
            strNum = parseInt(strNum);
            if (strNum.length <= 3) {
                return strNum;
            }
            if (!/^(\+|-     )?(\d+)(\.\d+)?$/.test(strNum)) {
                return strNum;
            }
            var a = RegExp.$1,
                b = RegExp.$2,
                c = RegExp.$3;
            var re = new RegExp();
            re.compile("(\\d)(\\d{3})(,|$)");
            while (re.test(b)) {
                b = b.replace(re, "$1,$2$3");
            }
            return a + "" + b + "" + c;
        }
    </script>
</body>

</html>